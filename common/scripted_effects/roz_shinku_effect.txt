roz_junn_country_create = {
	optimize_memory
	create_country = {
		name = "NAME_nfield_junn"
		type = ge_N_Field
		flag = {
			icon = {
				category = "nfield_junn"
				file = "flag_roz_junn.dds"
			}
			background = {
				category = "backgrounds"
				file = "inverted_v.dds"
			}
			colors = {
				"black"
				"black"
				"null"
				"null"
			}
		}
		effect = {
			save_global_event_target_as = roz_junn_global_country@root
			set_country_flag = roz_junn_country
		}
	}
	last_created_country = {
		establish_communications_no_message = root
	}
	event_target:roz_junn_global_country@root = {
		owner = {
		}
	}
}

roz_hinaichigo_country_create = {
	optimize_memory
	create_country = {
		name = "NAME_nfield_hinaichigo"
		type = ge_N_Field
		flag = {
			icon = {
				category = "nfield_hinaichigo"
				file = "flag_roz_hinaichigo.dds"
			}
			background = {
				category = "backgrounds"
				file = "inverted_v.dds"
			}
			colors = {
				"black"
				"black"
				"null"
				"null"
			}
		}
		effect = {
			save_global_event_target_as = roz_hinaichigo_global_country@root
			set_country_flag = roz_hinaichigo_country
		}
	}
	last_created_country = {
		establish_communications_no_message = root
	}
	set_country_flag = roz_hinaichigo_arrive
}

roz_madgod_country_initiate = {
	optimize_memory
	create_species = {
		name_list = roz_abyss_faction
		name = random
		class = random_non_machine
		portrait = random
		traits = {
			ideal_planet_class = pc_habitat
			trait = random_traits
		}
	}
	create_country = {
		name_list = roz_abyss_faction
		name = NAME_madgod_force_country
		type = roz_madgod_empire
		ignore_initial_colony_error = yes
		authority = auth_hive_mind
		civics = {
			civic = civic_ancient_memories_of_control
		}
		origin = origin_fallen_empire_hive
		species = last_created_species
		flag = {
			icon = {
				category = "roz_special"
				file = "roz_madgod.dds"
			}
			background = {
				category = "backgrounds"
				file = "vertical.dds"
			}
			colors = {
				"red"
				"red"
				"null"
				"null"
			}
		}
		ethos = {
			ethic = ethic_gestalt_consciousness
		}
		effect = { add_modifier = { modifier = roz_madgod_country_naval_country_buff } }
	}
	last_created_country = {
		set_country_flag = roz_madgod_force_country_flag
		set_graphical_culture = extra_dimensional_02
		save_global_event_target_as = roz_madgod_force_country@root
		set_hostile = root
		# every_country = {
		# 	limit = {
		# 		NOR = {
		# 			has_country_flag = roz_abyss_vass_country
		# 			is_hostile = prev
		# 		}
		# 	}
		# 	set_hostile = prev
		# }
		establish_communications_no_message = root
	}
}

roz_madgod_fleet_jtcl_create_direct = {
	#方案一
	optimize_memory
	create_fleet = {
		name = "NAME_roz_krks_zakko"
		settings = {
			spawn_debris = no
			is_boss = yes
		}
		effect = {
			set_owner = event_target:roz_madgod_force_country@root
			set_fleet_flag = roz_madgod_jtcl_fleet
			while = {
				count = 14
				create_ship = {
					name = "NAME_EDDY_ROZ"
					design = "NAME_Corrupted_Avatar"
					effect = {  }
				}
			}
			set_location = event_target:roz_n_field_site_target@root
			set_fleet_stance = aggressive
			set_aggro_range_measure_from = return_point
			set_aggro_range = 300
			add_modifier = {
				modifier = roz_krks_bf_stage3_HK_buff
				mult = 1.5
			}
		}
	}
}

roz_madgod_fleet_jtcl_create_decoy = {
	#方案二
	optimize_memory
	create_fleet = {
		name = "NAME_roz_krks_zakko"
		settings = {
			spawn_debris = no
			is_boss = yes
		}
		effect = {
			set_owner = event_target:roz_madgod_force_country@root
			set_fleet_flag = roz_madgod_jtcl_fleet
			while = {
				count = 10
				create_ship = {
					name = "NAME_EDDY_ROZ"
					design = "NAME_Corrupted_Avatar"
					effect = {  }
				}
			}
			set_location = event_target:roz_n_field_site_target@root
			set_fleet_stance = aggressive
			set_aggro_range_measure_from = return_point
			set_aggro_range = 300
			add_modifier = {
				modifier = roz_krks_bf_stage3_HK_buff
			}
		}
	}
	# create_fleet = {
	# 	name = "NAME_roz_krks_zakko"
	# 	settings = {
	# 		spawn_debris = no
	# 		is_boss = yes
	# 	}
	# 	effect = {
	# 		set_owner = event_target:roz_suigintou_owner0
	# 		while = {
	# 			count = 3
	# 			create_ship = {
	# 				name = "NAME_Corrupted_Avatar"
	# 				design = "NAME_Corrupted_Avatar"
	# 				effect = {
	# 					#set_timed_ship_flag = { #如果你开了mist
	# 					#	flag = invincible
	# 					#	days = 3
	# 					#}
	# 				}
	# 			}
	# 			set_location = prevprev
	# 			set_fleet_stance = aggressive
	# 			set_aggro_range_measure_from = return_point
	# 			set_aggro_range = 300
	#
	# 			add_modifier = {
	# 				modifier = roz_krks_bf_stage1_HK_buff
	# 			}
	# 		}
	# 	}
	# }
}

###感染体入侵
###比较ai态度，计算数量
roz_unholy_invasion_dip_effect = {
	while = {
		limit = {
			any_playable_country = {
				opinion_level = {
					who = root
					level $sign$ $opinion$
				}
				NOR = {
					has_country_flag = roz_unholy_invasion_dip_$opinion$_ai_flag
					has_country_flag = roz_abyss_vass_country
				}
			}
		}
		random_playable_country = {
			limit = {
				NOR = {
					has_country_flag = roz_unholy_invasion_dip_$opinion$_ai_flag
					has_country_flag = roz_abyss_vass_country
				}
			}
			set_country_flag = roz_unholy_invasion_dip_$opinion$_ai_flag
		}
		change_variable = {
			which = roz_unholy_invasion_dip_$opinion$_ai
			value = 1
		}
	}
}

# roz_unholy_invasion_dip_aggressive_effect = {
# 	while = {
# 		#支持者
# 		limit = {
# 			any_playable_country = {
# 				opinion_level = {
# 					who = root
# 					level >= good
# 				}
# 				NOT = {
# 					has_country_flag = roz_unholy_invasion_dip_aggressive_ai_flag
# 				}
# 			}
# 		}
# 		random_playable_country = {
# 			limit = {
# 				NOT = {
# 					has_country_flag = roz_unholy_invasion_dip_aggressive_ai_flag
# 				}
# 			}
# 			set_country_flag = roz_unholy_invasion_dip_aggressive_ai_flag
# 		}
# 		change_variable = {
# 			which = roz_unholy_invasion_dip_aggressive_ai
# 			value = 1
# 		}
# 	}
# }

# roz_unholy_invasion_dip_negative_effect = {
# 	while = {
# 		#反对者
# 		limit = {
# 			any_playable_country = {
# 				opinion_level = {
# 					who = root
# 					level <= poor
# 				}
# 				NOT = {
# 					has_country_flag = roz_unholy_invasion_dip_negative_ai_flag
# 				}
# 			}
# 		}
# 		random_playable_country = {
# 			limit = {
# 				NOT = {
# 					has_country_flag = roz_unholy_invasion_dip_negative_ai_flag
# 				}
# 			}
# 			set_country_flag = roz_unholy_invasion_dip_negative_ai_flag
# 		}
# 		change_variable = {
# 			which = roz_unholy_invasion_dip_negative_ai
# 			value = 1
# 		}
# 	}
# }

# roz_unholy_invasion_dip_neutral_effect = {
# 	while = {
# 		#中立者
# 		limit = {
# 			any_playable_country = {
# 				opinion_level = {
# 					who = root
# 					level = neutral
# 				}
# 				NOT = {
# 					has_country_flag = roz_unholy_invasion_dip_neutral_ai_flag
# 				}
# 			}
# 		}
# 		random_playable_country = {
# 			limit = {
# 				NOT = {
# 					has_country_flag = roz_unholy_invasion_dip_neutral_ai_flag
# 				}
# 			}
# 			set_country_flag = roz_unholy_invasion_dip_neutral_ai_flag
# 		}
# 		change_variable = {
# 			which = roz_unholy_invasion_dip_neutral_ai
# 			value = 1
# 		}
# 	}
# }

###真红初始化

###真红-切换科学家职位
roz_shinku_leader_type_switch_scientist = {
	optimize_memory
	set_country_flag = roz_shinku_scientist_active
	#若当前真红职位为指挥官
	if = {
		limit = {
			event_target:roz_leader_shinku_global_target@root = {
				leader_class = commander
			}
		}
		remove_country_flag = roz_shinku_commander_active
		#缓存国家目标领袖更新替换
		event_target:roz_shinku_commander_inactive_temp@root = { 
		kill_leader = {
				show_notification = no
			}
		}
		clear_global_event_target = roz_shinku_commander_inactive_temp@root
		clone_leader = {
			#event_target:roz_shinku_global_country是真红的缓存国家
			#target = event_target:roz_leader_shinku_global_target@root #这个global target是玩家的真红
			##clone leader的effect有时不会继承领袖的leader flag和variable（变量完全不能继承），自定义背景也没有，最好补上
			target = event_target:roz_leader_shinku_global_target@root   
			effect = {
				save_global_event_target_as = roz_shinku_commander_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
				roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
			}
		}
		#移除玩家的指挥官真红
		event_target:roz_leader_shinku_global_target@root = {
			kill_leader = {
				show_notification = no
			}
		}
		#创建或从缓存国家复制科学家真红
		roz_leader_type_switch_create_leader_initiate_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = scientist
			symbolic_trait_1 = leader_trait_roz_shinku_main
			symbolic_trait_2 = leader_trait_roz
			symbolic_trait_3 = leader_trait_roz
		}
		
		roz_leader_initialize_after_create_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = scientist
		}
	}

	#若当前真红职位为行政官
	if = {
		limit = {
			event_target:roz_leader_shinku_global_target@root = {
				leader_class = official
			}
		}
		remove_country_flag = roz_shinku_official_active
		#缓存国家目标领袖更新替换, 先kill了再说
		event_target:roz_shinku_official_inactive_temp@root = { #令临时存储国家的舰队司令真红消失
		kill_leader = {
				show_notification = no
			}
		}
		clear_global_event_target = roz_shinku_official_inactive_temp@root
		clone_leader = {
			#替换，event_target:roz_shinku_global_country是真红的缓存国家
			#target = event_target:roz_leader_shinku_global_target@root #这个global target是玩家的真红
			target = event_target:roz_leader_shinku_global_target@root   #刚刚存的target
			effect = {
				save_global_event_target_as = roz_shinku_official_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
				roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
			}
		}
		#移除玩家的指挥官真红
		event_target:roz_leader_shinku_global_target@root = {
			kill_leader = {
				show_notification = no
			}
		}
		#创建或从缓存国家复制科学家真红
		roz_leader_type_switch_create_leader_initiate_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = scientist
			symbolic_trait_1 = leader_trait_roz_shinku_main
			symbolic_trait_2 = leader_trait_roz
			symbolic_trait_3 = leader_trait_roz
		}
		
		roz_leader_initialize_after_create_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = scientist
		}
	}
}

###真红-切换指挥官职位
roz_shinku_leader_type_switch_commander = {
	optimize_memory
	set_country_flag = roz_shinku_commander_active
	#若当前真红职位为科学家
	if = {
		limit = {
			event_target:roz_leader_shinku_global_target@root = {
				leader_class = scientist
			}
		}
		remove_country_flag = roz_shinku_scientist_active
		#缓存国家目标领袖更新替换
		event_target:roz_shinku_scientist_inactive_temp@root = { 
		kill_leader = {
				show_notification = no
			}
		}
		clear_global_event_target = roz_shinku_scientist_inactive_temp@root
		clone_leader = {
			#event_target:roz_shinku_global_country是真红的缓存国家
			#target = event_target:roz_leader_shinku_global_target@root #这个global target是玩家的真红
			target = event_target:roz_leader_shinku_global_target@root   
			effect = {
				save_global_event_target_as = roz_shinku_scientist_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
				roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
			}
		}
		#移除玩家的科学家真红
		event_target:roz_leader_shinku_global_target@root = {
			kill_leader = {
				show_notification = no
			}
		}
		#创建或从缓存国家复制指挥官真红
		roz_leader_type_switch_create_leader_initiate_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = commander
			symbolic_trait_1 = leader_trait_roz_shinku_main
			symbolic_trait_2 = leader_trait_roz
			symbolic_trait_3 = leader_trait_roz
		}
		
		roz_leader_initialize_after_create_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = commander
		}

		last_created_leader = {
			
		}
	}

	#若当前真红职位为行政官
	if = {
		limit = {
			event_target:roz_leader_shinku_global_target@root = {
				leader_class = official
			}
		}
		remove_country_flag = roz_shinku_official_active
		#缓存国家目标领袖更新替换, 先kill了再说
		event_target:roz_shinku_official_inactive_temp@root = { #令临时存储国家的舰队司令真红消失
		kill_leader = {
				show_notification = no
			}
		}
		clear_global_event_target = roz_shinku_official_inactive_temp@root
		clone_leader = {
			#替换，event_target:roz_shinku_global_country是真红的缓存国家
			#target = event_target:roz_leader_shinku_global_target@root #这个global target是玩家的真红
			target = event_target:roz_leader_shinku_global_target@root
			effect = {
				save_global_event_target_as = roz_shinku_official_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
				roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
			}
		}
		#移除玩家的指挥官真红
		event_target:roz_leader_shinku_global_target@root = {
			kill_leader = {
				show_notification = no
			}
		}
		#创建或从缓存国家复制指挥官真红
		roz_leader_type_switch_create_leader_initiate_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = commander
			symbolic_trait_1 = leader_trait_roz_shinku_main
			symbolic_trait_2 = leader_trait_roz
			symbolic_trait_3 = leader_trait_roz
		}
		
		roz_leader_initialize_after_create_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = commander
		}

		last_created_leader = {
			
		}
	}
}

###真红-切换行政官职位
roz_shinku_leader_type_switch_official = {
	optimize_memory
	set_country_flag = roz_shinku_official_active
	#若当前真红职位为科学家
	if = {
		limit = {
			event_target:roz_leader_shinku_global_target@root = {
				leader_class = scientist
			}
		}
		remove_country_flag = roz_shinku_scientist_active
		#缓存国家目标领袖更新替换
		event_target:roz_shinku_scientist_inactive_temp@root = { 
		kill_leader = {
				show_notification = no
			}
		}
		clear_global_event_target = roz_shinku_scientist_inactive_temp@root
		clone_leader = {
			#event_target:roz_shinku_global_country是真红的缓存国家
			#target = event_target:roz_leader_shinku_global_target@root #这个global target是玩家的真红
			target = event_target:roz_leader_shinku_global_target@root   
			effect = {
				save_global_event_target_as = roz_shinku_scientist_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
				roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
			}
		}
		#移除玩家的科学家真红
		event_target:roz_leader_shinku_global_target@root = {
			kill_leader = {
				show_notification = no
			}
		}
		#创建或从缓存国家复制行政官真红
		roz_leader_type_switch_create_leader_initiate_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = official
			symbolic_trait_1 = leader_trait_roz_shinku_main
			symbolic_trait_2 = leader_trait_roz
			symbolic_trait_3 = leader_trait_roz
		}
		
		roz_leader_initialize_after_create_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = official
		}
	}

	#若当前真红职位为指挥官
	if = {
		limit = {
			event_target:roz_leader_shinku_global_target@root = {
				leader_class = commander
			}
		}
		remove_country_flag = roz_shinku_commander_active
		#缓存国家目标领袖更新替换, 先kill了再说
		event_target:roz_shinku_commander_inactive_temp@root = { #令临时存储国家的舰队司令真红消失
		kill_leader = {
				show_notification = no
			}
		}
		clear_global_event_target = roz_shinku_commander_inactive_temp@root
		clone_leader = {
			#替换，event_target:roz_shinku_global_country是真红的缓存国家
			#target = event_target:roz_leader_shinku_global_target@root #这个global target是玩家的真红
			target = event_target:roz_leader_shinku_global_target@root
			effect = {
				save_global_event_target_as = roz_shinku_commander_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
				roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
			}
		}
		#移除玩家的指挥官真红
		event_target:roz_leader_shinku_global_target@root = {
			kill_leader = {
				show_notification = no
			}
		}
		roz_leader_type_switch_create_leader_initiate_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = official
			symbolic_trait_1 = leader_trait_roz_shinku_main
			symbolic_trait_2 = leader_trait_roz
			symbolic_trait_3 = leader_trait_roz
		}
		
		roz_leader_initialize_after_create_effect = {
			leader = shinku
			leader_sc = zhenhong
			leader_type = official
		}
	}
}



####封装####
roz_leader_type_switch_clone_initiate_effect = {	#在clone leader内使用
	unassign_leader = this
	freeze_leader_age = yes
	set_leader_flag = roz_$leader$_flag
	set_owner = event_target:roz_$country$@root
	roz_leader_name_set_effect = {
		who_jp = $leader$
		who_sc = $leader_sc$
	}
}

# roz_leader_type_switch_kill_initiate_effect = {	#remove将被切换职位的领袖
# 	every_owned_leader = {
# 		limit = {
# 			OR = {
# 				has_trait = $symbolic_trait_1$
# 				has_trait = $symbolic_trait_2$ #select to use
# 				has_leader_flag = roz_$leader$_flag
# 			}
# 			is_variable_set = roz_shinku_affection
# 		}
# 		unassign_leader = this
# 		kill_leader = {
# 			show_notification = no
# 		}
# 	}
# }	

roz_leader_type_switch_create_leader_initiate_effect = {	#生成领袖
	if = {	#从缓存国家复制备份
		limit = { 
			OR = {
				event_target:roz_$leader$_country@root = {
					any_owned_leader = {
						leader_class = $leader_type$
						has_trait = $symbolic_trait_1$
					}
				}
				exists = event_target:roz_$leader$_$leader_type$_inactive_temp@root
			}
		}
		roz_leader_type_switch_clone_from_cache_country_effect = {
			leader = $leader$
			leader_sc = $leader_sc$
			leader_type = $leader_type$
		}
	}
	else_if = {	#没有备份就新建
		limit = { #或许以后用得到
		}
		create_leader = {
			class = $leader_type$
			name = "NAME_$leader$"
			skill = 1
			gender = female
			species = owner_main_species
			immortal = yes
			event_leader = yes
			set_age = 17
			traits = { }
			skip_background_generation = yes
			custom_catch_phrase = $leader$_$leader_type$_catch_phrase
			custom_description = $leader$_backstory
			effect = {
				add_skill_without_trait_selection = 1
				remove_all_traits = yes
				set_variable = {
					which = roz_shinku_affection
					value = owner.roz_leader_aft_$leader$
				}
			}
		}
		last_created_leader = {
			set_leader_flag = roz_$leader$_flag
			freeze_leader_age = yes
			switch = {
				trigger = leader_class
				scientist = {
					random_list = {
						1 = { add_trait = { trait = leader_trait_surveyor } }
						1 = { add_trait = { trait = leader_trait_midas_touch } }
						1 = { add_trait = { trait = leader_trait_knowledge_for_the_masses } }
						1 = { add_trait = { trait = leader_trait_great_researcher } }
						1 = { add_trait = { trait = leader_trait_truth_seeker } }
						1 = { add_trait = { trait = leader_trait_brilliant_shipwright } }
						1 = { add_trait = { trait = leader_trait_frontier_adventurer } }
						1 = { add_trait = { trait = leader_trait_xeno_cataloger } }
						2 = { add_trait = { trait = leader_trait_knowledge_for_the_masses } }
					}
				}
				commander = {
					random_list = {
						1 = { add_trait = { trait = leader_trait_armorer } }
						1 = { add_trait = { trait = leader_trait_military_overseer } }
						1 = { add_trait = { trait = leader_trait_master_gunner } }
						1 = { add_trait = { trait = leader_trait_destiny_engineer } }
						1 = { add_trait = { trait = leader_trait_guerilla_tactics } }
						1 = { add_trait = { trait = leader_trait_survivalist } }
						1 = { add_trait = { trait = leader_trait_maven_of_war } }
						2 = { add_trait = { trait = leader_trait_peacekeeper } }
					}
					random_list = {
						1 = { add_trait = { trait = leader_trait_taskmaster } }
						1 = { add_trait = { trait = leader_trait_fortress_cracker } }
						1 = { add_trait = { trait = leader_trait_chainbreaker } }
						1 = { add_trait = { trait = leader_trait_honored_warmaster } }
						1 = { add_trait = { trait = leader_trait_academia_recruiter } }
						1 = { add_trait = { trait = leader_trait_supreme_warrior } }
						1 = { add_trait = { trait = leader_trait_spymaster } }
						1 = { add_trait = { trait = leader_trait_totalitarian } }
						1 = { add_trait = { trait = leader_trait_bellicose } }
					}
				}
				official = {
					random_list = {
						1 = { add_trait = { trait = leader_trait_efficient } }
						1 = { add_trait = { trait = leader_trait_arbiter } }
						2 = { add_trait = { trait = leader_trait_utopian_idealist } }
						1 = { add_trait = { trait = leader_trait_mediator } }
						1 = { add_trait = { trait = leader_trait_shroud_preacher } }
						1 = { add_trait = { trait = leader_trait_master_diplomat } }
						1 = { add_trait = { trait = leader_trait_galvanizer } }
					}
				}
			}
			add_trait = { trait = $symbolic_trait_1$ }
			add_trait = { trait = $symbolic_trait_2$ }
			add_trait = { trait = $symbolic_trait_3$ }
		}
	}
}

roz_leader_type_switch_clone_from_cache_country_effect = {
	clone_leader = {	#从临时国家复制领袖备份到玩家国家，变量和flag的设置在下一个封装
		target = event_target:roz_$leader$_$leader_type$_inactive_temp@root
		custom_catch_phrase = $leader$_$leader_type$_catch_phrase
		custom_description = $leader$_backstory
		effect = {
			freeze_leader_age = yes
			roz_leader_name_set_effect = {
				who_jp = $leader$
				who_sc = $leader_sc$
			}
			set_leader_flag = roz_$leader$_flag
			set_owner = event_target:roz_$leader$_owner@root
			#东方繁星录兼容
			if = {
				limit = { this = { spth_check_gensokyo_auth = yes } }
				set_leader_flag = own_th_leader_trait
			}
		}
	}
}

###必须已经新创建领袖（非克隆）才能用, 需要先清除领袖外貌flag（country）再设置，然后再执行该封装
###并非必须，并非需要，并非然后（
roz_leader_initialize_after_create_effect = {
	last_created_leader = {
		#set_leader_flag = roz_$leader$_flag
		set_leader_flag = legendary_leader
		set_leader_flag = immune_to_negative_traits
		set_leader_flag = leader_death_events_blocked
		#set_leader_flag = has_gained_level_trait
		#freeze_leader_age = yes
		roz_leader_name_set_effect = {
			who_jp = $leader$
			who_sc = $leader_sc$
		}
		save_global_event_target_as = roz_leader_$leader$_global_target@root
		set_variable = {
			which = roz_$leader$_affection
			value = root.roz_leader_aft_$leader$
		}
		set_variable = {
			which = leader_pending_negative_traits_unmodified
			value = event_target:roz_$leader$_$leader_type$_inactive_temp@root.leader_pending_negative_traits_unmodified
		}
		if = {
			limit = { check_variable = { which = roz_$leader$_affection value >= 90 } }
			add_trait = { trait = leader_trait_roz_a_love }
		}
		else_if = {
			limit = { check_variable = { which = roz_$leader$_affection value >= 60 } }
			add_trait = { trait = leader_trait_roz_a_like }
		}
		else_if = {
			limit = { check_variable = { which = roz_$leader$_affection value >= 30 } }
			add_trait = { trait = leader_trait_roz_a_friendly }
		}
		else_if = {
			limit = { check_variable = { which = roz_$leader$_affection value < 30 } }
			add_trait = { trait = leader_trait_roz_a_strangeness }
		}
	}
	roz_leader_change_skin_reset_effect = {
		leader = $leader$
		skin_index1 = 1
		skin_index2 = 2
		skin_index3 = 3
		skin_index4 = 4
		skin_index5 = 5
		skin_index6 = 6
		skin_index7 = 7
		skin_index8 = 8
		skin_index9 = 9
		skin_index10 = 10
		skin_index11 = 11
		skin_index12 = 12
		skin_index13 = 13
		skin_index14 = 14
		skin_index15 = 15
		skin_index16 = 20
		skin_index17 = 21
		skin_index18 = 22
		skin_index19 = sp1
		skin_index20 = sp2
		skin_index20 = 61
		skin_index22 = default
		skin_index23 = 20th
	}
	
}

###真红月检备份（或者说是更新备份）
roz_shinku_leader_backup = {
    if = {	#指挥官备份
        limit = {
            event_target:roz_leader_shinku_global_target@root = {
                leader_class = commander
            }
        }
        event_target:roz_shinku_commander_inactive_temp@root = { #去掉全局国家的缓存真红
            kill_leader = {
                show_notification = no
            }
        }
        clear_global_event_target = roz_shinku_commander_inactive_temp@root
        clone_leader = { #替换当前的真红（指挥官）到全局国家
            target = event_target:roz_leader_shinku_global_target@root
            effect = {
                save_global_event_target_as = roz_shinku_commander_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
                roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
            }
        }
    }
	if = {	#科学家备份
        limit = {
            event_target:roz_leader_shinku_global_target@root = {
                leader_class = scientist
            }
        }
        event_target:roz_shinku_scientist_inactive_temp@root = { #去掉全局国家的缓存真红
            kill_leader = {
                show_notification = no
            }
        }
        clear_global_event_target = roz_shinku_scientist_inactive_temp@root
        clone_leader = { #替换当前的真红（指挥官）到全局国家
            target = event_target:roz_leader_shinku_global_target@root
            effect = {
                save_global_event_target_as = roz_shinku_scientist_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
                roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
            }
        }
    }
	if = {	#行政官备份
        limit = {
            event_target:roz_leader_shinku_global_target@root = {
                leader_class = official
            }
        }
        event_target:roz_shinku_official_inactive_temp@root = { #去掉全局国家的缓存真红
            kill_leader = {
                show_notification = no
            }
        }
        clear_global_event_target = roz_shinku_official_inactive_temp@root
        clone_leader = { #替换当前的真红（指挥官）到全局国家
            target = event_target:roz_leader_shinku_global_target@root
            effect = {
                save_global_event_target_as = roz_shinku_official_inactive_temp@root
				roz_leader_pending_negative_traits_unmodified_count = yes
                roz_leader_type_switch_clone_initiate_effect = {
					leader = shinku
					leader_sc = zhenhong
					country = shinku_global_country
				}
				#东方繁星录兼容
				if = {
					limit = { this = { spth_check_gensokyo_auth = yes } }
					set_leader_flag = own_th_leader_trait
				}
            }
        }
    }
}



roz_leader_change_skin_reset_effect = {	#scope = country
    switch = {
        trigger = has_country_flag
        roz_$leader$_portrait_change_roz_$leader$_$skin_index1$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index1$
                leader_flag = roz_$leader$_flag
            }
        }    
		roz_$leader$_portrait_change_roz_$leader$_$skin_index2$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index2$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index3$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index3$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index4$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index4$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index5$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index5$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index6$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index6$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index7$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index7$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index8$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index9$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index9$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index9$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index10$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index10$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index11$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index11$
                leader_flag = roz_$leader$_flag
            }
        }    
		roz_$leader$_portrait_change_roz_$leader$_$skin_index12$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index12$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index13$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index13$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index14$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index14$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index15$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index15$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index16$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index16$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index17$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index17$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index18$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index18$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index19$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index19$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index20$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index20$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index21$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index21$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index22$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index22$
                leader_flag = roz_$leader$_flag
            }
        }
		roz_$leader$_portrait_change_roz_$leader$_$skin_index23$ = {
            roz_leader_change_skin_flag_locate_effect = {
                who = $leader$
                portrait = roz_$leader$
                flag = roz_$leader$_portrait_change
                portrait_key = roz_$leader$_$skin_index23$
                leader_flag = roz_$leader$_flag
            }
        }
    }
}

roz_leader_change_skin_reset_shinku_effect = {
    switch = {
        trigger = has_country_flag
        roz_shinku_portrait_change_roz_shinku_20th = {
            roz_leader_change_skin_flag_locate_effect = {
                who = shinku
                portrait = roz_shinku
                flag = roz_shinku_portrait_change
                portrait_key = roz_shinku_20th
                leader_flag = roz_shinku_flag
            }
        }
        roz_shinku_portrait_change_roz_shinku_01 = {
            roz_leader_change_skin_flag_locate_effect = {
                who = shinku
                portrait = roz_shinku
                flag = roz_shinku_portrait_change
                portrait_key = roz_shinku_01
                leader_flag = roz_shinku_flag
            }
        }
    }
}

roz_remove_shinkureilc_random_list_effect = {	#special project没有scope导致的，random不了一点
	optimize_memory
	random_list = {
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol3 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol3 }
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol4 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol4 }
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol5 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol5 }
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol6 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol6 }
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol7 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol7 }
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol8 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol8 }
		1 = { modifier = { factor = 0 NOT = { has_relic = roz_shuukan_shoujonotsukurikata_vol9 } } remove_relic = roz_shuukan_shoujonotsukurikata_vol9 }
	}
}

roz_remove_shinkureilc_effect = {	#special project没有scope导致的
	optimize_memory
	switch = {
		trigger = has_country_flag
		roz_shoujonotsukurikata_project_2_complete = { remove_country_flag = roz_shoujonotsukurikata_project_2_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol2 }
		roz_shoujonotsukurikata_project_3_complete = { remove_country_flag = roz_shoujonotsukurikata_project_3_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol3 }
		roz_shoujonotsukurikata_project_4_complete = { remove_country_flag = roz_shoujonotsukurikata_project_4_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol4 }
		roz_shoujonotsukurikata_project_5_complete = { remove_country_flag = roz_shoujonotsukurikata_project_5_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol5 }
		roz_shoujonotsukurikata_project_6_complete = { remove_country_flag = roz_shoujonotsukurikata_project_6_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol6 }
		roz_shoujonotsukurikata_project_7_complete = { remove_country_flag = roz_shoujonotsukurikata_project_7_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol7 }
		roz_shoujonotsukurikata_project_8_complete = { remove_country_flag = roz_shoujonotsukurikata_project_8_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol8 }
		roz_shoujonotsukurikata_project_9_complete = { remove_country_flag = roz_shoujonotsukurikata_project_9_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol9 }
		roz_shoujonotsukurikata_project_10_complete = { remove_country_flag = roz_shoujonotsukurikata_project_10_complete remove_relic = roz_shuukan_shoujonotsukurikata_vol10 }
	}
}

roz_shoujonotsukurikata_project_common_effect = {
	optimize_memory
	if = {
		limit = { check_variable = { which = roz_shinku_progress_count value = 2 } }
		country_event = { id = roz_shinku_evt.110 }
	}
	else_if = {
		limit = { check_variable = { which = roz_shinku_progress_count value <= 9 } }
		country_event = { id = roz_shinku_evt.120 }
		country_event = { id = roz_shinku_evt.130 }
	}
	else = { country_event = { id = roz_shinku_evt.140 } }
}

roz_unholy_invision_difficult_modifier_effect = {
	optimize_memory
	if = {
		limit = { check_variable = { which = roz_unholy_invasion_difficulty value = $value$ } }
		add_modifier = { modifier = roz_unholy_invasion_difficult_modifier mult = $dif_factor$ }
	}
}

roz_unholy_invision_difficult_modifier_add_effect = {
	optimize_memory
	roz_unholy_invision_difficult_modifier_effect = { value = 1 dif_factor = @roz_UID_easy }
	roz_unholy_invision_difficult_modifier_effect = { value = 2 dif_factor = @roz_UID_normal }
	roz_unholy_invision_difficult_modifier_effect = { value = 3 dif_factor = @roz_UID_hard }
	roz_unholy_invision_difficult_modifier_effect = { value = 4 dif_factor = @roz_UID_xiling }
}

roz_abyss_vass_select = {
	optimize_memory
	if = {
		limit = { check_variable = { which = roz_unholy_invasion_difficulty value = $value$ } }
		while = {
			count = $dif_factor$
			random_playable_country = {
				limit = {
					is_ai = yes
					is_country_type = default
					roz_is_regular_authority = yes
					roz_is_MOD_country = no
					NOR = {
						is_roz_abyss_vass_extra_country_global_target = yes
						has_country_flag = roz_abyss_vass_country
						is_country_type = roz_madgod_empire
					}
				}
				set_country_flag = roz_abyss_vass_country
				set_subject_of = {
					who = event_target:roz_madgod_force_country@root
				}
				#加buff
				roz_unholy_invision_difficult_modifier_effect = { value = $value$ dif_factor = $dif_factor$ }
				root = {
					create_point_of_interest = {
						id = roz_abyss_vass_country
						name = roz_abyss_vass_country_name
						desc = roz_abyss_vass_country_desc
						event_chain = roz_SK_madgod_invasion_main
						location = prev.capital_scope
					}
				}
			}
		}
	}
}

roz_abyss_vass_after_select = {
	optimize_memory
	every_country = { #齐宣王
		limit = {
			NOT = { is_at_war_with = prev }
			is_default_or_fallen = yes
			NOR = {
				has_country_flag = roz_abyss_vass_country
				is_country_type = roz_madgod_empire
			}
		}
		if = { #所有宗主国对深渊宣战
			limit = { is_subject = no }
			declare_war = {
				target = event_target:roz_madgod_force_country@root
				name = { key = roz_abyss_war }
				attacker_war_goal = wg_roz_abyss_war
			}
		}
		else = { join_war = overlord } #所有附属国加入战争
		every_country = {
			limit = {
				has_country_flag = roz_abyss_vass_country
			}
			add_opinion_modifier = {
				who = prev
				modifier = opinion_roz_abyss_vass
			}
			set_hostile = prev
			set_faction_hostility = { target = prev set_hostile = yes set_neutral = no set_friendly = no }
			join_war = overlord
		}
	}
}

roz_abyss_vass_select_diff = {
	optimize_memory
	roz_abyss_vass_select = { value = 1 dif_factor = @roz_UID_easy }
	roz_abyss_vass_select = { value = 2 dif_factor = @roz_UID_normal }
	roz_abyss_vass_select = { value = 3 dif_factor = @roz_UID_hard }
	roz_abyss_vass_select = { value = 4 dif_factor = @roz_UID_xiling }

	roz_abyss_vass_after_select = yes
}

roz_abyss_vass_create = {
	optimize_memory
	random_system = {
		limit = {
			NOR = {
				exists = space_owner
				space_owner = { is_regular_empire = yes }
				is_fe_cluster = yes
				has_owner = yes
				star = {
					or = {
						is_planet_class = pc_black_hole
						is_planet_class = pc_pulsar
						is_planet_class = pc_neutron_star
					}
				}
				any_neighbor_system = {
					OR = {
						exists = space_owner
						space_owner = { is_regular_empire = yes }
						has_owner = yes
						is_fe_cluster = yes
						any_neighbor_system = {
							OR = {
								exists = space_owner
								space_owner = { is_regular_empire = yes }
								has_owner = yes
								is_fe_cluster = yes
							}
						}
					}
				}
			}
		}
		random_system_planet = {
			limit = {
				OR = {
					is_star = no
					is_asteroid = no
					is_primary_star = no
					is_moon = no
					is_colony = no
				}
				NOR = {
					is_planet_class = pc_asteroid
					is_planet_class = pc_ice_asteroid
				}
			}
			change_pc = pc_gaia
			set_planet_size = 22
			create_species = {
				class = random
				name = random
				portrait = random
				traits = {
					trait = random_presapient_trait
					trait = random_traits
					trait = random_traits
					trait = random_traits
					trait = random_traits
					trait = random_traits
				}
			}
			create_country = {
				type = default
				name_list = random
				name = random
				species = last_created_species
				ignore_initial_colony_error = yes
				origin = origin_default
				ethos = random
				authority = random
				civics = { civic = random civic = random }
				flag = random
				effect = {
					create_leader = {
						class = random_ruler
						species = owner_main_species
						name = random
						skill = 5
					}
					copy_techs_from = { target = root }
					add_resource = {
						minerals = 10000
						energy = 10000
						food = 3000
						consumer_goods = 1500
						alloys = 1500
						unity = 2500
						influence = 500
					}
					#set_graphical_culture = mammalian_01
					save_global_event_target_as = roz_abyss_vass_extra_$index$_target@root
					#set_country_flag = roz_abyss_vass_country
				}
			}
			set_owner = last_created_country
			set_capital = yes
			set_name = random
			add_building = building_capital
			add_building = building_roz_abyss_altar_unknow
			remove_building = building_colony_shelter
			while = {
				count = 30
				create_pop_group = {
					species = last_created_species
				}
			}
			while = { count = 8 add_random_non_blocker_deposit = yes }
			set_variable = {
				which = energy_districts
				value = 3
			}
			set_variable = {
				which = mining_districts
				value = 3
			}
			set_variable = {
				which = farming_districts
				value = 3
			}
			add_district_and_planet_size_if_needed_effect_amount = {
				amount = energy_districts
				district = district_generator
			}
			add_district_and_planet_size_if_needed_effect_amount = {
				amount = mining_districts
				district = district_mining
			}
			add_district_and_planet_size_if_needed_effect_amount = {
				amount = farming_districts
				district = district_farming
			}
			clear_variable = energy_districts
			clear_variable = mining_districts
			clear_variable = farming_districts

			add_zone = {
				district = mining_districts
				zone = zone_minerals
				zone_slot = 1
			}
			add_zone = {
				district = energy_districts
				zone = zone_energy
				zone_slot = 1
			}
			add_zone = {
				district = farming_districts
				zone = zone_food
				zone_slot = 1
			}
			last_created_country = {
				establish_communications_no_message = root
				set_name = random
			}
			solar_system = {
				create_starbase = {
					owner = last_created_country
					size = starbase_starport
					module = shipyard
					module = solar_panel_network
					effect = {
						set_starbase_building = {
							slot = 1
							building = naval_logistics_office
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = last_created_country
						create_ship = {
							name = random
							random_existing_design = science
						}
						set_fleet_stance = evasive
						set_location = last_created_country.capital_scope.star
					}
				}
				last_created_country = {
					create_leader = {
						name = random
						set_age = 25
						class = scientist
						skill = 1
						traits = { trait = random_trait trait = random_trait }
						species = owner_main_species
						effect = { last_created_fleet = { assign_leader = prev } }
					}
				}
				create_fleet = {
					effect = {
						set_owner = last_created_country
						create_ship = {
							name = random
							random_existing_design = constructor
						}
						set_fleet_stance = evasive
						set_location = last_created_country.capital_scope.star
					}
				}
				create_fleet = {
					effect = {
						set_owner = last_created_country
						while = {
							count = 3
							create_ship = {
								name = random
								random_existing_design = corvette
							}
						}
						set_fleet_stance = passive
						set_location = last_created_country.capital_scope.star
					}
				}
				last_created_country = {
					create_leader = {
						name = random
						set_age = 21
						class = commander
						skill = 1
						traits = { trait = random_trait trait = random_trait }
						species = owner_main_species
						effect = { last_created_fleet = { assign_leader = prev } }
					}
				}
				create_fleet = {
					name = "NAME_sgt"
					settings = {
						spawn_debris = no
						is_boss = no
					}
					effect = {
						set_owner = ROOT
						create_ship = {
							name = NAME_sgt
							design = NAME_sgt
							graphical_culture = owner
							prefix = no
						}
						set_location = {
							target = PREV.star
							distance = 45
							angle = random
						}
					}
				}
			}
		}
	}
}

roz_abyss_vass_create_in_diff = {
	optimize_memory
	if = {
		limit = {
			NOT = { has_country_flag = roz_abyss_vass_had_created }
			has_country_flag = roz_abyss_vass_had_create_available
		}
		if = {
			limit = { event_target:global_event_country = { check_variable = { which = roz_unholy_invasion_difficulty value >= 1 } } }
			roz_abyss_vass_create = { index = 1 }
		}
		if = {
			limit = { event_target:global_event_country = { check_variable = { which = roz_unholy_invasion_difficulty value >= 2 } } }
			roz_abyss_vass_create = { index = 2 }
		}
		if = {
			limit = { event_target:global_event_country = { check_variable = { which = roz_unholy_invasion_difficulty value >= 3 } } }
			roz_abyss_vass_create = { index = 3 }
		}
		if = {
			limit = { event_target:global_event_country = { check_variable = { which = roz_unholy_invasion_difficulty value >= 4 } } }
			roz_abyss_vass_create = { index = 4 }
			roz_abyss_vass_create = { index = 5 }
		}
		set_country_flag = roz_abyss_vass_had_created
	}
}

roz_abyss_vass_extra_awaken = {
	optimize_memory
	event_target:roz_abyss_vass_extra_$index$_target@root = {
		set_country_flag = roz_abyss_vass_country
		set_subject_of = {
			who = event_target:roz_madgod_force_country@root
		}
		#加buff
		roz_unholy_invision_difficult_modifier_add_effect = yes
		join_war = overlord
		every_country = {
			limit = {
				NOT = { is_at_war_with = prev }
				is_default_or_fallen = yes
				NOR = {
					has_country_flag = roz_abyss_vass_country
					is_country_type = roz_madgod_empire
				}
			}
			set_hostile = prev
			set_faction_hostility = { target = prev set_hostile = yes set_neutral = no set_friendly = no }
		}
	}
}

roz_abyss_vass_extra_awaken_in_diff = {
	optimize_memory
	if = {
		limit = { has_country_flag = roz_abyss_vass_had_created }
		roz_abyss_vass_extra_awaken = { index = 1 }
		roz_abyss_vass_extra_awaken = { index = 2 }
		roz_abyss_vass_extra_awaken = { index = 3 }
		roz_abyss_vass_extra_awaken = { index = 4 }
		roz_abyss_vass_extra_awaken = { index = 5 }
	}
}

roz_abyss_ship_random_create = {
	optimize_memory
	while = {
		count = $num_ships$
		random_list = {
			1 = {
				create_ship = {
					name = NAME_roz_abyss_$name1$
					design = roz_crisis_ship_$design$
					prefix = no
				}
			}
			1 = {
				create_ship = {
					name = NAME_roz_abyss_$name2$
					design = roz_crisis_ship_$design$
					prefix = no
				}
			}
			1 = {
				create_ship = {
					name = NAME_roz_abyss_$name3$
					design = roz_crisis_ship_$design$
					prefix = no
				}
			}
			1 = {
				create_ship = {
					name = NAME_roz_abyss_$name4$
					design = roz_crisis_ship_$design$
					prefix = no
				}
			}
		}
	}
}

roz_abyss_ship_create = {
	optimize_memory
	while = {
		count = $num_ships$
		create_ship = {
			name = $name$
			design = roz_crisis_ship_$design$
			prefix = no
		}
	}
}

roz_abyss_leader_create = {
	optimize_memory
	event_target:roz_madgod_force_country@root = {
		create_leader = {
			name = $name$
			class = $leader_class$
			skill = 10
			set_age = 9527
			custom_catch_phrase = roz_abyss_leader_ccp
			custom_description = roz_abyss_leader_cd
			hide_age = yes
			immortal = yes
			randomize_traits = yes
			skip_background_generation = yes
			effect = {
				change_leader_portrait = roz_exd_$color$
				freeze_leader_age = yes
				add_trait = { trait = $trait1$ }
			}
		}
	}
}

roz_abyss_fleet_create_small = {
	optimize_memory
	create_fleet = {
		name = "NAME_roz_abyss_small_fleet"
		settings = {
			spawn_debris = no
			is_boss = no
		}
		effect = {
			set_fleet_flag = roz_abyss_fleet_small
			set_owner = $owner$
			roz_abyss_ship_create = {
				num_ships = 16
				design = probe_design_A
				name = random
			}
			roz_abyss_ship_create = {
				num_ships = 2
				design = battlecruiser_design_A
				name = random
			}
			set_location = {
				target = $location$
				distance = 45
				angle = random
			}
		}
	}
}
roz_abyss_fleet_create_small_in_diff = {
	optimize_memory
	while = {
		count = event_target:global_event_country.roz_unholy_invasion_difficulty
		roz_abyss_fleet_create_small = { owner = $owner$ location = $location$ }
	}
}

roz_abyss_fleet_create_median = {
	optimize_memory
	create_fleet = {
		name = random
		settings = {
			spawn_debris = no
			is_boss = no
		}
		effect = {
			set_fleet_flag = roz_abyss_fleet_median
			set_owner = $owner$
			roz_abyss_ship_create = {
				num_ships = 16
				design = probe_design_A
				name = random
			}
			roz_abyss_ship_create = {
				num_ships = 8
				design = battlecruiser_design_A
				name = random
			}
			roz_abyss_ship_create = {
				num_ships = 2
				design = titan_design_A
				name = random
			}
			set_location = {
				target = $location$
				distance = 45
				angle = random
			}
		}
	}
}
roz_abyss_fleet_create_median_in_diff = {
	optimize_memory
	while = {
		count = event_target:global_event_country.roz_unholy_invasion_difficulty
		roz_abyss_fleet_create_median = { owner = $owner$ location = $location$ }
	}

}

roz_abyss_fleet_create_large = {
	optimize_memory
	create_fleet = {
		name = random
		settings = {
			spawn_debris = no
			is_boss = no
		}
		effect = {
			set_owner = $owner$
			roz_abyss_ship_create = {
				num_ships = 16
				design = battlecruiser_design_A
				name = random
			}
			roz_abyss_ship_create = {
				num_ships = 4
				design = titan_design_A
				name = random
			}
			set_location = {
				target = $location$
				distance = 45
				angle = random
			}
		}
	}
}
roz_abyss_fleet_create_large_in_diff = {
	optimize_memory
	while = {
		count = event_target:global_event_country.roz_unholy_invasion_difficulty
		roz_abyss_fleet_create_large = { owner = $owner$ location = $location$ }
	}

}

roz_abyss_fleet_create_marvelous = {
	optimize_memory
	create_fleet = {
		name = NAME_roz_abyss_marvelous_fleet
		settings = {
			spawn_debris = no
			is_boss = yes
		}
		effect = {
			set_fleet_flag = roz_abyss_fleet_marvelous
			set_owner = event_target:roz_madgod_force_country@root
			roz_abyss_ship_create = {
				num_ships = 24
				design = battlecruiser_design_A
				name = random
			}
			roz_abyss_ship_create = {
				num_ships = 12
				design = titan_design_A
				name = random
			}
			set_location = {
				target = event_target:roz_n_field_site_target@root
				distance = 45
				angle = random
			}
		}
	}
}
roz_abyss_fleet_create_marvelous_in_diff = {
	optimize_memory
	while = {
		count = event_target:global_event_country.roz_unholy_invasion_difficulty
		roz_abyss_fleet_create_marvelous = yes
	}
}

roz_abyss_fleet_create_madgod_boss = {
	optimize_memory
	create_fleet = {
		name = NAME_roz_abyss_madgod_boss
		settings = {
			spawn_debris = no
			is_boss = yes
		}
		effect = {
			set_fleet_flag = roz_abyss_fleet_madgod_boss
			set_owner = event_target:roz_madgod_force_country@root
			roz_abyss_ship_create = {
				num_ships = 8
				design = titan_design_A
				name = random
			}
			roz_abyss_ship_create = {
				num_ships = 1
				design = madgod_boss_design_A
				name = NAME_roz_abyss_madgod_boss
			}
			set_location = {
				target = event_target:roz_n_field_site_target@root
				distance = 45
				angle = random
			}
		}
	}
}
